# 变更日志 (CHANGELOG)

所有重要的项目变更都会记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)。

---

## [Unreleased] - 2026-02-28

### 修复 🐛
- **手机面板下滑关闭手势鲁棒性修复**
  - 修复从面板 header 开始下滑、在 header 外抬起时无法关闭的问题
  - 将手势收尾监听扩展到文档级指针事件，避免丢失 `pointerup/pointercancel`
- **编辑模式双指缩放补齐**
  - 修复手机端双指缩放仅在 demo 模式生效的问题，编辑模式下也可 pinch 缩放
  - 保持单指拖拽优先级与只读 `hostMode=view` 门禁行为

### 改进 🔧
- **手机端触控可达性提升**
  - 提升手机属性面板折叠按钮、输入控件、操作按钮的最小触控高度
  - 提升手机横屏底部导航与关键面板按钮最小触控高度，统一触控阈值
- **几何直接编辑反馈增强**
  - 新增手机端画布几何浮层 `real/display/scale`，拖拽手柄时实时显示当前值
  - 结束拖拽或取消交互后自动隐藏浮层
- **手机快捷几何编辑效率优化**
  - 新增“最近编辑字段”记忆并在选中面板使用 recent-first 排序
  - 对不兼容几何字段自动丢弃历史，避免跨对象污染

### 文档 📚
- 新增 `docs/README.md` 作为文档统一入口
- 新增 `docs/documentation-system.md` 定义文档分层、命名、更新矩阵与归档策略
- 更新 `README.md`、`TESTING-GUIDE.md` 接入文档系统与手机端验收基线

## [1.2.0] - 2025-12-06

### 新增 ✨
- **深色/浅色主题支持**：完整的主题切换系统
  - 新增 `ThemeManager.js` 模块，提供完整的主题管理功能
  - 深色模式（默认）：VS Code风格配色，适合长时间使用
  - 浅色模式：Windows 10风格配置，高对比度设计
  - 一键切换按钮（🌙/☀️）在头部导航栏
  - 主题偏好自动保存到 localStorage
  - 首次加载时自动检测系统主题设置
  
- **Canvas元素主题适配**
  - GridRenderer：网格线颜色随主题变化
  - FieldVisualizer：电场箭头和磁场符号颜色主题感知
  - 粒子轨迹线条颜色优化
  
- **CSS主题变量系统**
  - 23+ CSS变量支持深色/浅色两套配置
  - 所有UI组件通过CSS变量继承主题
  - 平滑的主题切换过渡动画
  
- **主题测试工具**
  - `test-theme.html`：交互式主题测试页面
  - `THEME-GUIDE.md`：详细的主题系统使用文档
  - `test_theme_integration.py`：自动化集成测试脚本

### 改进 🔧
- **主程序集成**：main.js中添加ThemeManager初始化和事件绑定
- **渲染优化**：Canvas渲染器自动检测当前主题并使用相应颜色
- **用户体验**：主题切换时显示成功通知反馈

### 兼容性 ✅
- Chrome/Edge (所有现代版本)
- Firefox 31+
- Safari 9.1+
- Opera (所有现代版本)
- 需要支持 CSS Custom Properties 和 localStorage

### 文档 📚
- 新增 `THEME-GUIDE.md`：主题系统完整指南
  - ThemeManager API 文档
  - CSS主题变量对照表
  - 使用流程和最佳实践
  - 问题诊断指南

---

## [1.1.0] - 2025-12-05

### 新增 ✨
- **清空场景功能**：新增清空按钮（🗑️），可一键清空所有对象
  - 带确认对话框，防止误操作
  - 清空后显示成功通知
  - 保留场景设置
  
- **导出场景功能**：新增导出按钮（📤）
  - 将当前场景导出为JSON格式文件
  - 自动生成时间戳文件名
  - 包含所有对象配置和场景设置
  - 支持跨设备和分享
  
- **导入场景功能**：新增导入按钮（📥）
  - 从JSON文件导入场景配置
  - 自动验证文件格式和数据完整性
  - 显示导入对象数量统计
  - 友好的错误提示信息
  
- **场景数据验证**：新增 `Serializer.validateSceneData()` 方法
  - 验证version字段
  - 验证数组字段完整性
  - 返回详细错误信息

- **示例场景文件**：提供 `example-scene.json` 供测试使用
  - 包含2个电场
  - 包含1个磁场
  - 包含2个粒子（正负电荷各一）

### 改进 🔧
- **重置功能优化**：重置时同时刷新场强渲染层
- **场景加载增强**：`loadFromData()` 支持完整的对象反序列化
- **Serializer工具扩展**：
  - 新增 `exportToFile()` 方法
  - 新增 `importFromFile()` 方法
  - 新增 `validateSceneData()` 方法
  - 改进错误处理机制

### 文档 📚
- 新增 `README.md`：完整的项目文档
  - 功能特性说明
  - 详细使用指南
  - 场景文件格式规范
  - 物理常数参考
  - 故障排除指南
  
- 新增 `QUICKSTART.md`：快速开始指南
  - 新功能演示教程
  - 实际应用场景举例
  - 常见问题解答
  - 使用技巧分享

### 修复 🐛
- 修复场景加载后场强可视化未更新的问题
- 修复文件输入框未正确重置的问题

---

## [1.0.0] - 2025-12-05

### 初始发布 🎉

#### 核心功能
- **拖拽式界面**：从工具栏拖拽组件到画布
- **实时物理模拟**：基于RK4四阶龙格-库塔法
- **多种对象类型**：
  - 矩形均匀电场
  - 圆形均匀电场
  - 均匀磁场
  - 带电粒子

#### 物理引擎
- RK4数值积分器
- 完整的向量数学库
- 电场力、洛伦兹力、重力计算
- 边界弹性碰撞处理

#### 渲染系统
- 三层Canvas架构（背景/场/粒子）
- 网格渲染
- 场强矢量可视化
- 粒子轨迹绘制
- 能量信息HUD
- FPS性能监控
- 高DPI屏幕适配

#### 交互功能
- 对象拖拽移动
- 右键上下文菜单
- 动态属性面板
- 对象选择/复制/删除
- 键盘快捷键支持

#### 数据管理
- localStorage保存/加载
- 场景序列化/反序列化
- 预设场景（3个）

#### UI/UX
- 现代化深色主题
- 响应式布局
- 平滑动画效果
- 友好的通知系统

---

## 版本命名规范

遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范：

- **主版本号**：不兼容的API修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

## 图例

- ✨ 新增功能
- 🔧 改进优化
- 🐛 Bug修复
- 📚 文档更新
- 🎨 UI/样式改进
- ⚡ 性能优化
- 🔒 安全修复
- 🗑️ 移除功能

---

## 未来规划

### [1.2.0] - 计划中
- [ ] 半圆形电场
- [ ] 平行板电容器（边缘效应）
- [ ] 撤销/重做功能
- [ ] 多选对象操作
- [ ] 对象分组功能

### [1.3.0] - 计划中
- [ ] 动画录制导出
- [ ] 数据统计分析
- [ ] 图表可视化
- [ ] CSV数据导出

### [2.0.0] - 远期规划
- [ ] 3D可视化模式
- [ ] WebGL渲染引擎
- [ ] 更复杂的场类型
- [ ] 粒子间相互作用

---

**感谢使用！** 🙏

如有建议或发现问题，欢迎反馈。
