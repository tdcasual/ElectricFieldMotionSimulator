<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电磁场粒子运动模拟器</title>
    <link rel="stylesheet" href="styles/theme.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/animations.css">
</head>
<body>
    <div id="app">
        <!-- 顶部工具栏 -->
        <header id="header">
            <h1>⚡ 电磁场粒子运动模拟器</h1>
            <div class="header-controls">
                <button id="play-pause-btn" class="btn btn-primary" title="播放/暂停">
                    <span id="play-icon">▶️</span>
                </button>
                <button id="reset-btn" class="btn" title="重置">🔄</button>
                <button id="clear-btn" class="btn" title="清空场景">🗑️</button>
                <button id="save-btn" class="btn" title="保存场景">💾</button>
                <button id="load-btn" class="btn" title="加载场景">📂</button>
                <button id="export-btn" class="btn" title="导出场景">📤</button>
                <button id="import-btn" class="btn" title="导入场景">📥</button>
                <button id="theme-toggle-btn" class="btn" title="切换主题">🌙</button>
                <input type="file" id="import-file-input" accept=".json" style="display: none;">
                <label class="control-label">
                    <span>时间步长:</span>
                    <input type="range" id="timestep-slider" min="0.001" max="0.05" step="0.001" value="0.016">
                    <span id="timestep-value">16ms</span>
                </label>
            </div>
        </header>

        <!-- 左侧组件库工具栏 -->
        <aside id="toolbar">
            <h2>组件库</h2>
            <div class="tool-section">
                <h3>电场</h3>
                <div class="tool-item" draggable="true" data-type="electric-field-rect" title="均匀电场">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <rect x="4" y="4" width="16" height="16" stroke="currentColor" fill="none" stroke-width="2"/>
                        <path d="M8 12h8M12 8v8" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    <span>均匀电场</span>
                </div>
                <div class="tool-item" draggable="true" data-type="electric-field-circle" title="圆形电场">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <circle cx="12" cy="12" r="8" stroke="currentColor" fill="none" stroke-width="2"/>
                        <path d="M12 6v12M6 12h12" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    <span>圆形电场</span>
                </div>
                <div class="tool-item" draggable="true" data-type="electric-field-semicircle" title="半圆电场">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path d="M4 12 A8 8 0 0 1 20 12" stroke="currentColor" fill="none" stroke-width="2"/>
                        <line x1="4" y1="12" x2="20" y2="12" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>半圆电场</span>
                </div>
                <div class="tool-item" draggable="true" data-type="capacitor" title="平行板电容器">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <line x1="8" y1="4" x2="8" y2="20" stroke="currentColor" stroke-width="3"/>
                        <line x1="16" y1="4" x2="16" y2="20" stroke="currentColor" stroke-width="3"/>
                        <text x="10" y="14" font-size="10" fill="currentColor">+</text>
                        <text x="4" y="14" font-size="10" fill="currentColor">-</text>
                    </svg>
                    <span>平行板电容器</span>
                </div>
            </div>

            <div class="tool-section">
                <h3>磁场</h3>
                <div class="tool-item" draggable="true" data-type="magnetic-field" title="均匀磁场">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <circle cx="8" cy="8" r="2" fill="currentColor"/>
                        <circle cx="16" cy="8" r="2" fill="currentColor"/>
                        <circle cx="8" cy="16" r="2" fill="currentColor"/>
                        <circle cx="16" cy="16" r="2" fill="currentColor"/>
                    </svg>
                    <span>均匀磁场</span>
                </div>
            </div>

            <div class="tool-section">
                <h3>粒子</h3>
                <div class="tool-item" draggable="true" data-type="particle" title="带电粒子">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <circle cx="12" cy="12" r="6" fill="currentColor"/>
                    </svg>
                    <span>带电粒子</span>
                </div>
            </div>

            <div class="tool-section">
                <h3>预设场景</h3>
                <button class="preset-btn" data-preset="uniform-acceleration">匀加速运动</button>
                <button class="preset-btn" data-preset="cyclotron">回旋运动</button>
                <button class="preset-btn" data-preset="capacitor-deflection">电容器偏转</button>
            </div>
        </aside>

        <!-- 中央画布区域 -->
        <main id="canvas-area">
            <div id="canvas-container">
                <canvas id="bg-canvas"></canvas>
                <canvas id="field-canvas"></canvas>
                <canvas id="particle-canvas"></canvas>
            </div>
            <div id="fps-counter"></div>
        </main>

        <!-- 右侧属性面板 -->
        <aside id="property-panel" class="panel" style="display: none;">
            <div class="panel-header">
                <h3>属性面板</h3>
                <button id="close-panel-btn" class="btn-icon">✖</button>
            </div>
            <div id="property-content" class="panel-content">
                <!-- 动态生成 -->
            </div>
        </aside>

        <!-- 底部状态栏 -->
        <footer id="footer">
            <span id="status-text">就绪</span>
            <span id="object-count">对象: 0</span>
            <span id="particle-count">粒子: 0</span>
        </footer>
    </div>

    <!-- 右键菜单 -->
    <div id="context-menu" class="context-menu" style="display: none;">
        <div class="menu-item" id="menu-properties">⚙️ 属性</div>
        <div class="menu-item" id="menu-duplicate">📋 复制</div>
        <div class="menu-separator"></div>
        <div class="menu-item" id="menu-delete">🗑️ 删除</div>
    </div>

    <!-- 模态对话框 -->
    <div id="modal-overlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modal-title"></h3>
                <button id="modal-close-btn" class="btn-icon">✖</button>
            </div>
            <div id="modal-content" class="modal-content"></div>
            <div class="modal-footer">
                <button id="modal-cancel-btn" class="btn">取消</button>
                <button id="modal-confirm-btn" class="btn btn-primary">确定</button>
            </div>
        </div>
    </div>

    <!-- JavaScript模块 -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
