<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电磁场粒子运动模拟器</title>
    <link rel="stylesheet" href="styles/theme.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/animations.css">
</head>
<body>
    <div id="app">
        <!-- 顶部工具栏 -->
        <header id="header">
            <h1>⚡ 电磁场粒子运动模拟器</h1>
            <div class="header-controls">
                <button id="play-pause-btn" class="btn btn-primary" title="播放/暂停" aria-label="播放/暂停">
                    <span id="play-icon">▶️</span>
                </button>
                <button id="reset-btn" class="btn" title="重置" aria-label="重置">🔄</button>
                <button id="clear-btn" class="btn" title="清空场景" aria-label="清空场景">🗑️</button>
                <button id="save-btn" class="btn" title="保存场景" aria-label="保存场景">💾</button>
                <button id="load-btn" class="btn" title="加载场景" aria-label="加载场景">📂</button>
                <button id="export-btn" class="btn" title="导出场景" aria-label="导出场景">📤</button>
                <button id="import-btn" class="btn" title="导入场景" aria-label="导入场景">📥</button>
                <button id="theme-toggle-btn" class="btn" title="切换主题" aria-label="切换主题">🌙</button>
                <button id="variables-btn" class="btn" title="变量表" aria-label="变量表">ƒx</button>
                <button id="markdown-toggle-btn" class="btn" title="题目板" aria-label="题目板">📝</button>
                <input type="file" id="import-file-input" accept=".json" style="display: none;">
                <label class="control-label">
                    <span>显示能量:</span>
                    <input type="checkbox" id="toggle-energy-overlay" checked>
                </label>
                <label class="control-label">
                    <span>比例尺: 1m =</span>
                    <input type="number" id="scale-px-per-meter" min="0.0001" step="1" value="1">
                    <span>px</span>
                </label>
                <label class="control-label">
                    <span>重力 g:</span>
                    <input type="number" id="gravity-input" min="0" step="0.1" value="10">
                    <span>m/s²</span>
                </label>
                <label class="control-label">
                    <span>边界:</span>
                    <select id="boundary-mode-select" aria-label="边界处理方式">
                        <option value="margin">缓冲消失</option>
                        <option value="remove">出界消失</option>
                        <option value="bounce">反弹</option>
                        <option value="wrap">穿越</option>
                    </select>
                </label>
                <label class="control-label" id="boundary-margin-control">
                    <span>缓冲:</span>
                    <input type="number" id="boundary-margin-input" min="0" step="10" value="200">
                    <span>px</span>
                </label>
                <label class="control-label">
                    <span>时间步长:</span>
                    <input type="range" id="timestep-slider" min="0.001" max="0.05" step="0.001" value="0.016">
                    <span id="timestep-value">16ms</span>
                </label>
            </div>
        </header>        <!-- 左侧组件库工具栏 -->
        <aside id="toolbar">
            <h2>组件库</h2>
            <div id="toolbar-content"></div>

            <div class="tool-section">
                <h3>预设场景</h3>
                <button class="preset-btn" data-preset="uniform-acceleration">匀加速运动</button>
                <button class="preset-btn" data-preset="cyclotron">回旋运动</button>
                <button class="preset-btn" data-preset="capacitor-deflection">电容器偏转</button>
            </div>
        </aside>


        <!-- 中央画布区域 -->
        <main id="canvas-area">
            <div id="canvas-container">
                <canvas id="bg-canvas"></canvas>
                <canvas id="field-canvas"></canvas>
                <canvas id="particle-canvas"></canvas>
            </div>
            <div id="fps-counter"></div>

            <!-- Markdown 题目板（可拖拽） -->
            <div id="markdown-board" class="markdown-board" style="display: none;">
                <div class="markdown-board-header" id="markdown-board-header">
                    <div class="markdown-board-title">题目板</div>
                    <div class="markdown-board-actions">
                        <button id="markdown-edit-btn" class="btn-icon markdown-tab" title="编辑" aria-label="编辑">✎</button>
                        <button id="markdown-preview-btn" class="btn-icon markdown-tab" title="预览" aria-label="预览">👁</button>
                        <input id="markdown-font-size" class="markdown-font-input" type="number" min="10" max="32" step="1" value="13" title="字号 (px)" aria-label="字号 (px)">
                        <button id="markdown-clear-btn" class="btn-icon" title="清空" aria-label="清空">🧹</button>
                        <button id="markdown-close-btn" class="btn-icon" title="关闭" aria-label="关闭">✖</button>
                    </div>
                </div>
                <div class="markdown-board-body" id="markdown-board-body">
                    <textarea id="markdown-input" class="markdown-input" placeholder="在这里粘贴 Markdown 题目…"></textarea>
                    <div id="markdown-preview" class="markdown-preview"></div>
                </div>
            </div>
        </main>

        <!-- 右侧属性面板 -->
        <aside id="property-panel" class="panel" style="display: none;">
            <div class="panel-header">
                <h3>属性面板</h3>
                <button id="close-panel-btn" class="btn-icon" aria-label="关闭属性面板">✖</button>
            </div>
            <div id="property-content" class="panel-content">
                <!-- 动态生成 -->
            </div>
        </aside>

        <!-- 底部状态栏 -->
        <footer id="footer">
            <span id="status-text">就绪</span>
            <span id="object-count">对象: 0</span>
            <span id="particle-count">粒子: 0</span>
        </footer>
    </div>

    <!-- 右键菜单 -->
    <div id="context-menu" class="context-menu" style="display: none;">
        <div class="menu-item" id="menu-properties">⚙️ 属性</div>
        <div class="menu-item" id="menu-duplicate">📋 复制</div>
        <div class="menu-separator"></div>
        <div class="menu-item" id="menu-delete">🗑️ 删除</div>
    </div>

    <!-- 模态对话框 -->
    <div id="modal-overlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modal-title"></h3>
                <button id="modal-close-btn" class="btn-icon" aria-label="关闭对话框">✖</button>
            </div>
            <div id="modal-content" class="modal-content"></div>
            <div class="modal-footer">
                <button id="modal-cancel-btn" class="btn">取消</button>
                <button id="modal-confirm-btn" class="btn btn-primary">确定</button>
            </div>
        </div>
    </div>

    <!-- JavaScript模块 -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
